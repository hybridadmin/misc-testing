# ---------------------------------------------------------
# Valkey production-ready configuration
# ---------------------------------------------------------

# --- Network ---
bind 0.0.0.0
port 6379
tcp-backlog 511
timeout 300
tcp-keepalive 60

# --- Auth (ACL) ---
# Password is passed at runtime via --requirepass (env var VALKEY_PASSWORD)
# so it is not baked into this config file.

# --- Memory ---
maxmemory 256mb
maxmemory-policy allkeys-lru

# --- Persistence (AOF) ---
# Append-only file for durability; fsync every second (good trade-off)
appendonly yes
appendfsync everysec
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# RDB snapshots as a safety net alongside AOF
save 900 1
save 300 10
save 60 10000
rdbcompression yes
rdbchecksum yes

# --- Limits ---
maxclients 10000

# --- Logging ---
# loglevel is passed at runtime via --loglevel (env var VALKEY_LOGLEVEL)
# so it is not baked into this config file.

# --- Security hardening ---
# Disable dangerous commands in production
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command DEBUG ""

# --- Latency ---
latency-monitor-threshold 100

# --- Slow log ---
slowlog-log-slower-than 10000
slowlog-max-len 128
